---
---
Redovisning kmom10
=========================

### clo
Grunden 

Som mall för mitt projekt så valde jag att använda Stackoverflow eftersom dom flesta kraven pekade åt det hållet. Det gick ju att modifiera kraven om man ville göra något som liknar sociala medier mer, men ett röstningssystem hade större intresse. Starten på projektet gick väldigt bra och grunden för koden som står för trådar och användare gjorde en bra bas för resten av arbetet. Active Records gör att CRUD-baserade funktioner blir tillgängliga snabbt och utan större förberedelse. Detta skapade dock problem för andra typer av förfrågningar, men mer om det senare i redovisningen. Hemsidan handlar om TV-serien The Boys som blev väldigt populär under 2019 och fångade mitt intresse. Där kan man posta frågor och funderingar om vad som händer i serien tillsammans med taggar för att göra varje tråd mer relevant. Likt Stackoverflow så kan en kommentar markeras som rätt svar av trådskaparen och då delas poäng ut enligt senare krav. 

Hemsidans databas är SQLite eftersom det är portabelt och smidigt för denna typ av arbete. En viss trygghet har byggts upp från databas-kursen så jag valde att modellera direkt från start för att strukturera och framför allt återställa information. Eftersom Active Records bara kräver tre rader kod för att initialisera och hämta data så tänkte jag inte så mycket på att modifiera eller skapa hjälpfunktioner för att utveckla routes. Detta var helt klart ett misstag tycker jag då allt eftersom så behöver man mer och mer objekt från databasen och antalet rader per route växer väldigt snabbt. Hade det funnits mer tid så skulle jag skrivit om alla typer av databasförfrågningar för att göra det mer läsbart. Utvecklarna av paketet formade sina metoder på detta sett av en anledning så finns ju en charm i att använda det just så också. 

En utmaning som dök upp under arbetet var att dirigera användare om en felaktig handling uppstod. Redirect-metoden accepterar inte data likt Add från render så jag kunde inte skicka med felmeddelanden. Response objektet hade ett antal metoder som jag utforskade men lyckades inte skicka data till en route. Möjligtvis att man kunde göra det via session men det hade inte sett snyggt ut och kräver att man tömmer dom variablerna så att rätt felmeddelanden dyker upp under formulärhantering. Istället för att citera svar till andra kommenterar så valde jag att använda nummer och länkar. Det är inte fullt lika traditionellt som referenser men det ser snyggare ut. Denna typ av svar använde en hemsida som jag besökte för många år sedan och jag saknar den strukturen. Under utvecklingen hade jag helt glömt bort kravet där man kunde sortera kommentarerna så den första lösningen som involverade att numrera varje inlägg fick ett käpp i hjulet. Som lösning så expanderades modellen kommentar med ett frivilligt värde som är referens till rätt id.  

 

### Frågor

Relativt tidigt i arbetet så valde jag att implementera en röstningssystem för varje fråga och svar. Då kursen databas var en väldigt stabil grund för hur SQL ska modelleras så var det inga problem. Här saknade jag triggers och ordentliga join-förfrågningar extremt mycket. Det finns ju tekniskt sätt inget som säger att jag inte kan skapa dom via en SQL-fil men det kändes som fusk om jag ska vara ärlig. Vi har väl installerat Active Records av en anledning så tanken är väl att man ska använda just det. Likt andra poängsystem så ökas en kommentar eller tråd med ett. Bakom kulisserna så får användarna mer privata poäng för att dom varit involverade i lösningsprocessen, som belöning för hjälpen. Ett svar som markeras som “korrekt” är det högsta typen av poäng man kan få och ger en användare ett bra rykte. Utan SQL-satser så blev jag lite osäker på hur man kunde sortera beroende på poäng men genom att modifiera och ordna arrayer så gick det bra. Vyer hade kommit väldigt bra till hands i denna typ av situationer så man känner sig lite mer i kontroll.  

 

### Användare

Likt tidigare krav så jobbade jag på denna funktionalitet tidigt. Varje tråd och kommentar ger olika mängder poäng och sparas i databasen via länkade tabeller. Den totala poängen är ditt rykte där högre är bättre. Under varje användares profilsida så ser man en översikt av alla inlägg och svar som personen har gjort. Om man röstar flera gånger på samma tråd eller kommentar så dubblas och inverteras rösten och därmed blir en positiv röst transformerad till en negativ. För den som inspekterat koden noggrant så ser man att det både finns poängtabeller samt en poängattribut på vissa klasser. Detta är mest för att slippa gör en drös av förfrågningar till databasen för att hitta alla poäng för en tråd eller kommentar. Möjligtvis är det onödigt arbete men om applikationen skulle växa så känns det snabbare och då kan template-vyer förberedas snabbare. I teori så ska summan av poäng alltid vara synkroniserad med attributen om koden är rätt, vilket den hittills är.  

 

### Valfri

Innan jag startade projektet så bestämde jag mig för att lägga extra mycket energi på modelleringen av databasen för att uppnå detta krav. Med stor inspiration från tidigare databaskurs så strukturerade jag filerna på liknande sätt och kedjar dom tillsammans med sqlite3 för att förstöra och bygga upp datan på nytt på ett smidigt sätt. Jag beslutade mig sedan att återkomma till dessa SQL-filer och skapade några triggers för att dela ut poäng ordentligt. Eftersom jag skapar 20 trådar och 20 kommentarer direkt så blir det snabbt komplicerat att dela ut poäng till frågor, svar och användare men med triggers så underlättas arbetet enormt. Då man inte har tillgång till routes via SQLite så är det nästan ett måste för att scaffolda databasen. Detta gör att framsidan så hemsidan blir mycket mer intressant och rolig att titta på. Via makefilen så går det också att återställa databasen med kommandot “make reset-db" så att utvecklingen kan fortsättas utan hinder. När informationen sedan är lagrad så förstörs alla triggers så att applikationen själv uppdateras via PHP-koden istället för på automatik via SQLite. 

 

### Projekt

Utvecklingen av hemsidan gick rätt bra ändå. Efter dom första dagarna så kändes det som om man kunde blir klar på bara en vecka, men allt med tiden så blev man motbevisad. Jag skulle faktiskt vilja nominera detta projekt som den mest tidskrävande bland alla kurser i Dbwebb. Det som gav mig mest huvudverk var nog bristen på ordentliga join-förfrågningar. Bland klasserna för att hämta data så lade jag till några metoder för att stödja join. Problemet som uppstår är det blir konflikt på attributer som har samma namn. I det här fallet så är det självklart id som strular till det. Om jag hade manuell kontroll över hela förfrågan så hade det inte varit några bekymmer, men det har jag inte riktigt. Lösning nummer två skulle vara att döpa om id till exempelvis user_id, men det känns inte speciellt logiskt och om jag minns korrekt så strider det mot dom standarder som vi lärt oss i kursen databas. Jag är väldigt nyfiken på hur företag löser detta problem samt om detta är ett dilemma för andra typer av Active Records system. Min lösning involverade att hämta samma information två gånger via join. Skillnaden per förfrågan är ordningen på klasserna i parametrarna vilket påverkar vilka id som returneras och därmed löser konflikten.  

 

### Kursen

Eftersom jag inte har andra erfarenheter med MVC ramverk annat än dom Anax versioner som Dbwebb erbjuder så ska det bli spännande att se hur andra företag använder dessa teknologier. Det jag kommer ta med mig mest från kursen är nog dependency injection därför att det löser många problem som man uppstå under utveckling men framför allt testning. I mina tester så valde jag att inte testa routes som och orsaken är mest att jag inte visste hur jag skulle göra det utan att påverka databasen. Antingen via en konfigurationsfil som pekar på mot en annan databas som i sin tur återställs mellan varje test, men att mocka skulle ju också fungera. Problemet är att jag inte vet hur, i detta läge, man kan mocka just den delen när det är sektion av routen som körs rakt av när man kallar på den. 

Att det inte finns stor dokumentation för ramverket är på båda gott och ont. Att kunna läsa och förstå dokumentation är en stor det av att vara utvecklare, men det är också förmågan att kunna hoppa in i källkod och tolka vad som händer. Som en senare kurs som denna känns det mer okej jobba mot ett ramverk när man nästan är blind på det här viset, men om man har svårt att greppa vissa sektioner så är det extremt överväldigande. Att finna rätt balans är väldigt svårt eftersom det skiljer sig så mycket från student till student. Middleware var något som jag verkligen saknade under utvecklingen av projektet i alla fall. Lyckades inte hitta någon modul som kan hoppa in och till exempel läsa av sessionen för att avgöra om en sida ska ladda, dirigera om eller skriva ut ett felmeddelande.  Allt som allt skulle jag rekommendera kursen till någon som tycker om PHP. Kursen får en stark 7 av mig, men jag tror att poängen skulle bli högre om jag hade mer tid att blir bekväm med mer avancerade scaffolds så att mindre duplicerande mallar måste kodas. 
